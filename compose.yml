services:
  caddy:
    image: caddy:2-alpine
    restart: always
    ports:
      - "80:80"
      - "443:443"
      - "443:443/udp"
    volumes:
      - ./caddy:/etc/caddy
      - caddy_data:/data
      - caddy_config:/config
      - ./data/asoftfacade/ghost:/var/lib/ghost/content:ro
    deploy:
      resources:
        limits:
          cpus: '0.25'
          memory: 128M
        reservations:
          cpus: '0.10'
          memory: 64M

  adistantcloud:
    image: agiannif/adistantcloud:latest
    restart: always
    expose:
      - "1212"
    volumes:
      - ./data/adistantcloud/assets:/assets
      - ./data/adistantcloud/configs:/configs
    deploy:
      resources:
        limits:
          cpus: '0.15'
          memory: 24M
        reservations:
          cpus: '0.05'
          memory: 12M

  asoftfacade:
    image: ghost:6-alpine
    restart: always
    expose:
      - "2368"
    environment:
      NODE_ENV: production
      url: https://${GHOST_DOMAIN}
      database__client: sqlite3
      database__connection__filename: /var/lib/ghost/content/data/ghost.db
      NODE_OPTIONS: "--max-old-space-size=380"
    volumes:
      - ./data/asoftfacade/ghost:/var/lib/ghost/content
    deploy:
      resources:
        limits:
          cpus: '0.35'
          memory: 512M
        reservations:
          cpus: '0.20'
          memory: 256M

  skinnyform:
    image: agiannif/skinnyform:latest
    expose:
      - "3000"
    environment:
      GMAIL_CLIENT: ${SF_GMAIL_CLIENT}
      GMAIL_SECRET: ${SF_GMAIL_SECRET}
      GMAIL_REFRESH: ${SF_GMAIL_REFRESH}
      EMAIL_USER: ${SF_EMAIL_USER}
      EMAIL_TO: ${SF_EMAIL_TO}
      RATE_LIMIT_WINDOW: ${SF_RATE_LIMIT_WINDOW}
      RATE_LIMIT_MAX: ${SF_RATE_LIMIT_MAX}
      BLACKLISTED_DOMAINS: ${SF_BLACKLISTED_DOMAINS}
      ALLOWED_ORIGIN: ${SF_ALLOWED_ORIGIN}
    deploy:
      resources:
        limits:
          cpus: '0.15'
          memory: 24M
        reservations:
          cpus: '0.05'
          memory: 12M

volumes:
  caddy_data:
  caddy_config:
